<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1, width=device-width">
    <link rel="stylesheet" href="/style/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Caesar+Dressing&family=Caveat:wght@400..700&family=Special+Elite&display=swap"
        rel="stylesheet">
    <link href="https://use.fontawesome.com/releases/v5.0.1/css/all.css" rel="stylesheet">
    <link rel="icon" href="/images/logo.png" sizes="64x64" type="image/x-icon">

    <title>Create an Event</title>    
    <body>
    
        <div class="content">
            <h1>Create an Event</h1>
        
            <div class="create-event-container">
                <!-- Top Section (Image Upload and Preview) -->
                <div class="top-section">
                    <div class="upload-container" id="uploadBox" onclick="document.getElementById('eventImage').click();">
                        <span class="upload-text" id="uploadText">Click to upload an image/video. Uploaded 0/5</span>
                        <input type="file" id="eventImage" accept="image/*,video/*" onchange="handleFileUpload()" multiple>
                        <img id="uploadPreviewImage" class="upload-preview" style="display: none;">
                        <video id="uploadPreviewVideo" class="upload-preview" controls style="display: none;"></video>
                    </div>
                </div>
        
                <!-- Media Preview Below Top Section -->
                <div class="media-preview" id="mediaPreview">
                    <span id="uploadStatus">Uploaded 0/5</span>
                </div>
        
                <!-- Left Section (Event Details) -->
                <div class="left-section">
                    <label for="eventTitle">Event Title:</label>
                    <input type="text" id="eventTitle" placeholder="Enter Event Title" class="input-field"><br><br>
        
                    <label for="eventType">Event Type:</label>
                    <select id="eventType" class="select-field">
                        <option value="" selected disabled>Select Event Type</option>
                        <option value="concert">Concert</option>
                        <option value="conference">Conference</option>
                        <option value="workshop">Workshop</option>
                        <option value="festival">Festival</option>
                        <option value="webinar">Webinar</option>
                        <option value="seminar">Seminar</option>
                        <option value="networking-event">Networking Event</option>
                        <option value="trade-show">Trade Show</option>
                        <!-- <option value="other">Other (Specify)</option> -->
                    </select>
                    <!-- <input type="text" id="customEventType" placeholder="Specify event type" style="display:none;" class="input-field"> -->
        
                    <label for="eventCategory">Event Category:</label>
                    <select id="eventCategory" class="select-field">
                        <option value="" selected disabled>Select Event Category</option>
                        <option value="music">Music</option>
                        <option value="technology">Technology</option>
                        <option value="education">Education</option>
                        <option value="art">Art</option>
                        <option value="food">Food</option>
                        <option value="sports">Sports</option>
                        <!-- <option value="other">Other (Specify)</option> -->
                    </select><br><br>
                    <!-- <input type="text" id="customEventCategory" placeholder="Specify category" style="display:none;" class="input-field"><br><br> -->

                    <label for="eventVenue">Venue:</label>
                    <input type="text" id="eventVenue" placeholder="Enter Venue" class="input-field"><br><br>
        
                
                    <label for="eventStartDate">Start Date:</label>
                    <input type="date" id="eventStartDate" class="input-field">
        
                    <label for="eventEndDate">End Date:</label>
                    <input type="date" id="eventEndDate" class="input-field"><br><br>
        
                    <label for="eventStartTime">Start Time:</label>
                    <input type="time" id="eventStartTime" class="input-field">
        
                    <label for="eventEndTime">End Time:</label>
                    <input type="time" id="eventEndTime" class="input-field"><br><br>
        
                    <label for="eventDescription">Event Description:</label><br>
                    <textarea id="eventDescription" rows="4" cols="50" class="input-field"></textarea><br><br>
        
                    <label for="eventTags">Event Tags:</label>
                    <input type="text" id="eventTags" placeholder="Enter tags, comma separated" class="input-field"><br><br>
        
                    <h3>Tickets & Pricing</h3>
        
                    <label for="totalTickets">Total Number of Tickets:</label>
                    <input type="number" id="totalTickets" oninput="updateTicketTypes()" placeholder="Enter total tickets" class="input-field"><br><br>
        
                    <div id="ticketTypesContainer">
                        <label for="ticketTypeSelect">Ticket Type:</label>
                        <select id="ticketTypeSelect" onchange="addTicketType()" class="select-field">
                            <option value="" selected disabled>Select Ticket Type</option>
                            <option value="free">Free</option>
                            <option value="vip">VIP</option>
                            <option value="general">General Admission</option>
                            <option value="other">Other</option>
                        </select><br><br>

                        <div id="freeTicketFields" style="display: none;">
                            <label for="freeQuantity">Free Tickets Quantity:</label>
                            <input type="number" id="freeQuantity" class="input-field"><br><br>
                        </div>
                        
                        <div id="vipTicketFields" style="display: none;">
                            <label for="vipQuantity">VIP Tickets Quantity:</label>
                            <input type="number" id="vipQuantity" class="input-field">
                            <label for="vipPrice">VIP Ticket Price:</label>
                            <input type="number" id="vipPrice" class="input-field"><br><br>
                        </div>
                        
                        <div id="generalTicketFields" style="display: none;">
                            <label for="generalQuantity">General Admission Quantity:</label>
                            <input type="number" id="generalQuantity" class="input-field">
                            <label for="generalPrice">General Admission Price:</label>
                            <input type="number" id="generalPrice" class="input-field"><br><br>
                        </div>
                        
                        <div id="otherTicketFields" style="display: none;">
                            <label for="otherTicketName">Other Ticket Type:</label>
                            <input type="text" id="otherTicketName" class="input-field">
                            <label for="otherQuantity">Quantity:</label>
                            <input type="number" id="otherQuantity" class="input-field">
                            <label for="otherPrice">Price:</label>
                            <input type="number" id="otherPrice" class="input-field"><br><br>
                        </div>
                        
                    <button id="calculateAllocationButton" onclick="calculateAllocation()" class="button">Calculate Allocation</button><br><br>
                    </div>
        
                    <button onclick="updatePreview()" class="button">Preview</button>
                    <button oncick = "createEvent()" class = "button">Create Event</button>
                </div>
        
                <!-- Right Section (Styling Options) -->
                <div class="right-section">
                    <label for="eventColor">Background Color:</label>
                    <input type="color" id="eventColor" class="color-picker">
        
                    <label for="textColor">Text Color:</label>
                    <input type="color" id="textColor" class="color-picker"><br><br>
        
                    <label for="eventFont">Font:</label>
                    <select id="eventFont" class="select-field">
                        <option value="Arial, sans-serif">Arial</option>
                        <option value="'Courier New', monospace">Courier New</option>
                        <option value="'Georgia', serif">Georgia</option>
                        <option value="'Times New Roman', serif">Times New Roman</option>
                        <option value="'Comic Sans MS', cursive">Comic Sans</option>
                    </select><br><br>
        
                    <label for="textAlign">Text Alignment:</label>
                    <select id="textAlign" class="select-field">
                        <option value="left">Left</option>
                        <option value="center">Center</option>
                        <option value="right">Right</option>
                    </select><br><br>
        
                    <label for="borderStyle">Border Style:</label>
                    <select id="borderStyle" class="select-field">
                        <option value="solid">Solid</option>
                        <option value="dashed">Dashed</option>
                        <option value="dotted">Dotted</option>
                        <option value="double">Double</option>
                    </select><br><br>
        
                    <label for="borderRadius">Border Radius:</label>
                    <input type="range" id="borderRadius" min="0" max="50" value="10" class="range-slider"> px<br><br>
        
                    <label for="animationEffect">Animation Effect:</label>
                    <select id="animationEffect" class="select-field">
                        <option value="">None</option>
                        <option value="fade-in">Fade In</option>
                        <option value="slide-in">Slide In</option>
                        <option value="zoom-in">Zoom In</option>
                    </select><br><br>
                </div>
            </div>
        </div>
            <script>
                let mediaFiles = [];
                let currentPreview = null; // To store the currently enlarged preview media
    
                function handleFileUpload() {
                    const input = document.getElementById("eventImage");
                    const files = Array.from(input.files);
                    const previewContainer = document.getElementById("mediaPreview");
                    const uploadText = document.getElementById("uploadText");
    
                    if (mediaFiles.length + files.length > 5) {
                        alert("You can only upload up to 5 files.");
                        return;
                    }
    
                    files.forEach(file => {
                        if (mediaFiles.length >= 5) return;
    
                        mediaFiles.push(file);
    
                        const fileURL = URL.createObjectURL(file);
                        const previewWrapper = document.createElement("div");
                        previewWrapper.classList.add("preview-item");
    
                        let mediaElement;
                        if (file.type.startsWith("image")) {
                            mediaElement = document.createElement("img");
                            mediaElement.classList.add("preview-item");
                        } else if (file.type.startsWith("video")) {
                            mediaElement = document.createElement("video");
                            mediaElement.classList.add("preview-item");
                            mediaElement.controls = true;
                        }
    
                        mediaElement.src = fileURL;
                        mediaElement.onclick = () => togglePreviewMedia(file, fileURL, file.type);
    
                        previewWrapper.appendChild(mediaElement);
    
                        const removeBtn = document.createElement("button");
                        removeBtn.innerText = "X";
                        removeBtn.classList.add("remove-btn");
                        removeBtn.onclick = () => removeMedia(file, previewWrapper);
    
                        previewWrapper.appendChild(removeBtn);
                        previewContainer.appendChild(previewWrapper);
                    });
    
                    input.value = "";  // Reset input
    
                    // Update the upload text based on the number of files uploaded
                    uploadText.innerText = `Click to upload an image/video. Uploaded ${mediaFiles.length}/5`;
    
                    // Update the status below directly inside media preview
                    document.getElementById("uploadStatus").innerText = `Uploaded ${mediaFiles.length}/5`;
                }
    
                function removeMedia(file, wrapper) {
                    // Remove media from the preview container
                    mediaFiles = mediaFiles.filter(f => f !== file);
                    wrapper.remove();
    
                    const uploadText = document.getElementById("uploadText");
    
                    // Update the upload text after a file is removed
                    uploadText.innerText = `Click to upload an image/video. Uploaded ${mediaFiles.length}/5`;
                    uploadStatus.innerText = `Uploaded ${mediaFiles.length}/5`;
    
                    // If the removed media was the enlarged one, remove it from the upload container
                    if (currentPreview === file) {
                        hidePreview();
                    }
                }
    
                function togglePreviewMedia(file, fileURL, type) {
                    const uploadPreviewImage = document.getElementById("uploadPreviewImage");
                    const uploadPreviewVideo = document.getElementById("uploadPreviewVideo");
                    const uploadText = document.getElementById("uploadText");
    
                    // If the clicked media is already being previewed, hide it
                    if (currentPreview === file) {
                        hidePreview();
                        return;
                    }
    
                    // Hide both initially
                    uploadPreviewImage.style.display = "none";
                    uploadPreviewVideo.style.display = "none";
    
                    if (type.startsWith("image")) {
                        uploadPreviewImage.src = fileURL;
                        uploadPreviewImage.style.display = "block";
                    } else if (type.startsWith("video")) {
                        uploadPreviewVideo.src = fileURL;
                        uploadPreviewVideo.style.display = "block";
                    }
    
                    uploadText.style.display = "none";
    
                    currentPreview = file;
                }
    
                function hidePreview() {
                    document.getElementById("uploadPreviewImage").style.display = "none";
                    document.getElementById("uploadPreviewVideo").style.display = "none";
    
                    document.getElementById("uploadText").style.display = "block";
    
                    currentPreview = null;
                }

let totalTickets = 0;
let ticketsAdded = 0;
let ticketCategories = {};

// Function to update the total tickets
function updateTicketTypes() {
    totalTickets = parseInt(document.getElementById("totalTickets").value) || 0;
    ticketsAdded = 0; 
    ticketCategories = {}; 

}

// Show/hide ticket fields based on selection
function addTicketType() {
    let ticketTypeSelect = document.getElementById("ticketTypeSelect");
    let selectedType = ticketTypeSelect.value;

    if (selectedType in ticketCategories) {
        alert("This ticket category has already been added!");
        return;
    }

    // Show selected ticket category fields
    if (selectedType === "free") {
        document.getElementById("freeTicketFields").style.display = "block";
    } else if (selectedType === "vip") {
        document.getElementById("vipTicketFields").style.display = "block";
    } else if (selectedType === "general") {
        document.getElementById("generalTicketFields").style.display = "block";
    } else if (selectedType === "other") {
        document.getElementById("otherTicketFields").style.display = "block";
    }

    ticketCategories[selectedType] = { quantity: 0, price: 0 };
}

// Calculate allocation and show summary
function calculateAllocation() {
    let totalAllocated = 0;
    let ticketSummary = [];

    for (let type in ticketCategories) {
        let quantity = parseInt(document.getElementById(`${type}Quantity`).value) || 0;
        let price = type !== "free" ? parseFloat(document.getElementById(`${type}Price`).value) || 0 : 0;

        if (quantity > 0) {
            ticketSummary.push({ type, quantity, price });
            totalAllocated += quantity;
        }
    }

    if (totalAllocated > totalTickets) {
        alert("The total number of allocated tickets exceeds the available tickets!");
    } else {
        alert(`Ticket Allocation Successful: ${totalAllocated} tickets allocated.`);
        console.log(ticketSummary); // Log allocation details
    }
}


    let eventData = {
            id: 0,
    title: "",
    venue: "",
    description: "",
    startDate: "",
    endDate: "",
    startTime: "",
    endTime: "",
    tags: [],
    tickets: [], // This will store the ticket categories with their quantities and prices
    mediaFiles: [], // Store media files for the event (images, videos)
    styling: {
        bgColor: "",
        textColor: "",
        font: "",
        textAlign: "",
        borderStyle: "",
        borderRadius: 0,
        animationEffect: ""
    }
};
function convertToBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });
}

function updatePreview() {
    // Gather the event details
    eventData.id = 0;
    eventData.title = document.getElementById("eventTitle").value;
    eventData.venue = document.getElementById("eventVenue").value;
    eventData.description = document.getElementById("eventDescription").value;
    eventData.startDate = document.getElementById("eventStartDate").value;
    eventData.startTime = document.getElementById("eventStartTime").value;
    eventData.endDate = document.getElementById("eventEndDate").value;
    eventData.endTime = document.getElementById("eventEndTime").value;
    eventData.tags = document.getElementById("eventTags").value
        .split(',')
        .map(tag => tag.trim())
        .filter(tag => tag !== "");

    // Gather ticket information
    eventData.tickets = [];
    Object.entries(ticketCategories).forEach(([type, ticketCategory]) => {
        const quantity = parseInt(document.getElementById(`${type}Quantity`).value) || 0;
        const price = type !== "free" ? parseFloat(document.getElementById(`${type}Price`).value) || 0 : 0;

        if (quantity > 0) {
            eventData.tickets.push({
                type,
                quantity,
                price
            });
        }
    });

    // Gather media files and convert them to Base64
    eventData.mediaFiles = [];
    if (typeof mediaFiles !== "undefined") {
        const mediaPromises = Array.from(mediaFiles).map(async (file) => {
            const base64 = await convertToBase64(file);
            return {
                name: file.name,
                type: file.type,
                url: base64 // Store Base64 instead of Object URL
            };
        });

        // Wait for all media to be processed before proceeding
        Promise.all(mediaPromises).then(results => {
            eventData.mediaFiles = results;
            localStorage.setItem(`event-${eventData.id}`, JSON.stringify(eventData));
        });
    }

    // Gather styling preferences
    eventData.styling = {
        bgColor: document.getElementById("eventColor")?.value || "",
        textColor: document.getElementById("textColor")?.value || "",
        font: document.getElementById("eventFont")?.value || "",
        textAlign: document.getElementById("textAlign")?.value || "",
        borderStyle: document.getElementById("borderStyle")?.value || "",
        borderRadius: document.getElementById("borderRadius")?.value || "",
        animationEffect: document.getElementById("animationEffect")?.value || ""
    };

    // Store the data in local storage
    localStorage.setItem(`event-${eventData.id}`, JSON.stringify(eventData));

    // Redirect to eventPage.html with the event ID
    window.location.href = `eventPage.html?id=${encodeURIComponent(eventData.id)}`;
}

</script>
    

<div src="/partials/header.html" type="text/x-html-template"></div>
<div src="/partials/footer.html" type="text/x-html-template"></div>

<script src="/js/api.js"></script>
<script src="/js/ui.js"></script>


</body>
</html>

        